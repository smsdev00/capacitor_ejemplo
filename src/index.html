<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hardware Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    h2 {
      color: #333;
      margin-bottom: 16px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .icon {
      font-size: 24px;
    }

    button {
      width: 100%;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }

    #photoContainer {
      margin-top: 16px;
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f5;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #photoPreview {
      width: 100%;
      height: auto;
      display: none;
    }

    #photoPreview.show {
      display: block;
    }

    .placeholder {
      color: #999;
      text-align: center;
      padding: 20px;
    }

    .sensor-data {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }

    .sensor-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }

    .sensor-row:last-child {
      border-bottom: none;
    }

    .sensor-label {
      font-weight: 600;
      color: #495057;
    }

    .sensor-value {
      font-family: 'Courier New', monospace;
      color: #667eea;
      font-weight: bold;
    }

    .status {
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }

    .status.active {
      background: #d4edda;
      color: #155724;
    }

    .status.inactive {
      background: #f8d7da;
      color: #721c24;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .button-group button {
      flex: 1;
    }

    .stop-button {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> Hardware Demo</h1>

    <!-- Secci贸n de C谩mara -->
    <div class="card">
      <h2><span class="icon"></span> C谩mara</h2>
      <button id="takePictureBtn" onclick="takePicture()">
        Tomar Foto
      </button>
      <div id="photoContainer">
        <div class="placeholder" id="photoPlaceholder">
          La foto aparecer谩 aqu铆
        </div>
        <img id="photoPreview" alt="Foto capturada">
      </div>
    </div>

    <!-- Secci贸n de Giroscopio -->
    <div class="card">
      <h2><span class="icon"></span> Sensor de Movimiento</h2>
      <div class="button-group">
        <button id="startMotionBtn" onclick="startMotion()">
          Iniciar Sensor
        </button>
        <button id="stopMotionBtn" class="stop-button" onclick="stopMotion()" disabled>
          Detener
        </button>
      </div>
      <div id="motionStatus" class="status inactive">
        Sensor detenido
      </div>
      <div class="sensor-data">
        <div class="sensor-row">
          <span class="sensor-label">Aceleraci贸n X:</span>
          <span class="sensor-value" id="accelX">0.00</span>
        </div>
        <div class="sensor-row">
          <span class="sensor-label">Aceleraci贸n Y:</span>
          <span class="sensor-value" id="accelY">0.00</span>
        </div>
        <div class="sensor-row">
          <span class="sensor-label">Aceleraci贸n Z:</span>
          <span class="sensor-value" id="accelZ">0.00</span>
        </div>
        <div class="sensor-row">
          <span class="sensor-label">Rotaci贸n 伪 (Z):</span>
          <span class="sensor-value" id="rotAlpha">0.00</span>
        </div>
        <div class="sensor-row">
          <span class="sensor-label">Rotaci贸n 尾 (X):</span>
          <span class="sensor-value" id="rotBeta">0.00</span>
        </div>
        <div class="sensor-row">
          <span class="sensor-label">Rotaci贸n 纬 (Y):</span>
          <span class="sensor-value" id="rotGamma">0.00</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Importar Capacitor Core -->
  <script type="module">
    import { Capacitor } from 'https://cdn.jsdelivr.net/npm/@capacitor/core@6.0.0/dist/esm/index.js';
    import { Camera, CameraResultType, CameraSource } from 'https://cdn.jsdelivr.net/npm/@capacitor/camera@6.0.0/dist/esm/index.js';
    import { Motion } from 'https://cdn.jsdelivr.net/npm/@capacitor/motion@6.0.0/dist/esm/index.js';

    // Variable global para el listener del sensor
    let motionListener = null;

    // Funci贸n para tomar foto
    window.takePicture = async function() {
      const button = document.getElementById('takePictureBtn');
      const preview = document.getElementById('photoPreview');
      const placeholder = document.getElementById('photoPlaceholder');

      try {
        button.disabled = true;
        button.textContent = 'Abriendo c谩mara...';

        const image = await Camera.getPhoto({
          quality: 90,
          allowEditing: false,
          resultType: CameraResultType.DataUrl,
          source: CameraSource.Camera
        });

        // Mostrar la imagen
        preview.src = image.dataUrl;
        preview.classList.add('show');
        placeholder.style.display = 'none';

        button.textContent = 'Tomar Otra Foto';
      } catch (error) {
        console.error('Error al tomar la foto:', error);
        alert('Error: ' + error.message);
        button.textContent = 'Tomar Foto';
      } finally {
        button.disabled = false;
      }
    };

    // Funci贸n para iniciar el sensor de movimiento
    window.startMotion = async function() {
      const startBtn = document.getElementById('startMotionBtn');
      const stopBtn = document.getElementById('stopMotionBtn');
      const status = document.getElementById('motionStatus');

      try {
        startBtn.disabled = true;
        stopBtn.disabled = false;
        status.textContent = 'Iniciando sensor...';
        status.className = 'status';

        // Listener para aceleraci贸n
        motionListener = await Motion.addListener('accel', (event) => {
          document.getElementById('accelX').textContent = event.acceleration.x.toFixed(2);
          document.getElementById('accelY').textContent = event.acceleration.y.toFixed(2);
          document.getElementById('accelZ').textContent = event.acceleration.z.toFixed(2);
        });

        // Listener para rotaci贸n (giroscopio)
        await Motion.addListener('orientation', (event) => {
          document.getElementById('rotAlpha').textContent = (event.alpha || 0).toFixed(2);
          document.getElementById('rotBeta').textContent = (event.beta || 0).toFixed(2);
          document.getElementById('rotGamma').textContent = (event.gamma || 0).toFixed(2);
        });

        status.textContent = 'Sensor activo - Mueve el dispositivo';
        status.className = 'status active';
      } catch (error) {
        console.error('Error al iniciar el sensor:', error);
        alert('Error: ' + error.message);
        startBtn.disabled = false;
        stopBtn.disabled = true;
        status.textContent = 'Error al iniciar sensor';
        status.className = 'status inactive';
      }
    };

    // Funci贸n para detener el sensor
    window.stopMotion = async function() {
      const startBtn = document.getElementById('startMotionBtn');
      const stopBtn = document.getElementById('stopMotionBtn');
      const status = document.getElementById('motionStatus');

      try {
        if (motionListener) {
          await motionListener.remove();
          motionListener = null;
        }
        
        await Motion.removeAllListeners();

        startBtn.disabled = false;
        stopBtn.disabled = true;
        status.textContent = 'Sensor detenido';
        status.className = 'status inactive';

        // Resetear valores
        document.getElementById('accelX').textContent = '0.00';
        document.getElementById('accelY').textContent = '0.00';
        document.getElementById('accelZ').textContent = '0.00';
        document.getElementById('rotAlpha').textContent = '0.00';
        document.getElementById('rotBeta').textContent = '0.00';
        document.getElementById('rotGamma').textContent = '0.00';
      } catch (error) {
        console.error('Error al detener el sensor:', error);
      }
    };

    // Verificar si estamos en un dispositivo nativo
    console.log('Plataforma:', Capacitor.getPlatform());
    console.log('Es nativo:', Capacitor.isNativePlatform());
  </script>
</body>
</html>